Что выведет программа? Объяснить вывод программы. Объяснить как работают defer’ы и их порядок вызовов.

```go
package main

import (
    "fmt"
)


func test() (x int) {
    defer func() {
        x++
    }()
    x = 1
    return
}


func anotherTest() int {
	var x int
	defer func() {
		x++
	}()
	x = 1
	return x
}


func main() {
    fmt.Println(test())
    // 2
    fmt.Println(anotherTest())
    // 1
}
```

Ответ

```go
Можно изменять именованные возвращаемые значения в отложенных функциях, но нельзя изменять обычные возвращаемые значения.

Так происхоидт из-за того, что defer выполняется после return.
В случае с неименованным возвращаемым значением -> это значение уже было скопировано с х.
Модицифкация локальной переменной х после этого не повлияет на уже скопированное возвращаемое значение.
Т.к. defer владеет ссылкой на локальную переменную, значение которой уже было скопировано и вот-вот вернётся вызывающей стороне.

В случае с именованным возвращаемым значением -> это значение и есть возвращаемое значение, напрямую, без "копирований".
В этом случае defer владеет ссылкой на само возвращаемое значение, и, следовательно, можетего модифицировать перед возвратом управления по после return.

Defer выполянется после выхода из тела функции, в котором он был объявлен. (не области видимости)
Стеком
```
